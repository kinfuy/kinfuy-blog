import{_ as n,c as s,o as a,b as t}from"./app.c7c61b90.js";const f='{"title":"socket.io\u521D\u4F53\u9A8C","description":"","frontmatter":{"title":"socket.io\u521D\u4F53\u9A8C","theme":"default","tag":"Nodejs","time":"2021.3.31"},"headers":[{"level":2,"title":"socket.io \u521D\u4F53\u9A8C","slug":"socket-io-\u521D\u4F53\u9A8C"},{"level":3,"title":"\u4EC0\u4E48\u662F socket.io","slug":"\u4EC0\u4E48\u662F-socket-io"},{"level":3,"title":"\u5BA2\u6237\u7AEF\uFF08vue+vue-socket.io\uFF09","slug":"\u5BA2\u6237\u7AEF\uFF08vue-vue-socket-io\uFF09"},{"level":3,"title":"node \u670D\u52A1\u7AEF\uFF08express+socket.io\uFF09","slug":"node-\u670D\u52A1\u7AEF\uFF08express-socket-io\uFF09"}],"relativePath":"views/article/Nodejs/libs/socket.md"}',p={},o=t(`<h2 id="socket-io-\u521D\u4F53\u9A8C" tabindex="-1"><a href="http://socket.io" target="_blank" rel="noopener noreferrer">socket.io</a> \u521D\u4F53\u9A8C <a class="header-anchor" href="#socket-io-\u521D\u4F53\u9A8C" aria-hidden="true">#</a></h2><h3 id="\u4EC0\u4E48\u662F-socket-io" tabindex="-1">\u4EC0\u4E48\u662F <a href="http://socket.io" target="_blank" rel="noopener noreferrer">socket.io</a> <a class="header-anchor" href="#\u4EC0\u4E48\u662F-socket-io" aria-hidden="true">#</a></h3><p><a href="http://Socket.IO" target="_blank" rel="noopener noreferrer">Socket.IO</a> \u662F\u4E00\u4E2A\u5C01\u88C5\u4E86 Websocket\u3001\u57FA\u4E8E Node \u7684 JavaScript \u6846\u67B6\uFF0C\u5305\u542B client \u7684 JavaScript \u548C server \u7684 Node\u3002\u5176\u5C4F\u853D\u4E86\u6240\u6709\u5E95\u5C42\u7EC6\u8282\uFF0C\u8BA9\u9876\u5C42\u8C03\u7528\u975E\u5E38\u7B80\u5355\u3002\u53E6\u5916\uFF0C<a href="http://Socket.IO" target="_blank" rel="noopener noreferrer">Socket.IO</a> \u8FD8\u6709\u4E00\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u597D\u5904\u3002\u5176\u4E0D\u4EC5\u652F\u6301 WebSocket\uFF0C\u8FD8\u652F\u6301\u8BB8\u591A\u79CD\u8F6E\u8BE2\u673A\u5236\u4EE5\u53CA\u5176\u4ED6\u5B9E\u65F6\u901A\u4FE1\u65B9\u5F0F\uFF0C\u5E76\u5C01\u88C5\u4E86\u901A\u7528\u7684\u63A5\u53E3\u3002\u8FD9\u4E9B\u65B9\u5F0F\u5305\u542B Adobe Flash Socket\u3001Ajax \u957F\u8F6E\u8BE2\u3001Ajax multipart streaming \u3001\u6301\u4E45 Iframe\u3001JSONP \u8F6E\u8BE2\u7B49\u3002\u6362\u53E5\u8BDD\u8BF4\uFF0C\u5F53 <a href="http://Socket.IO" target="_blank" rel="noopener noreferrer">Socket.IO</a> \u68C0\u6D4B\u5230\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 WebSocket \u65F6\uFF0C\u80FD\u591F\u81EA\u52A8\u5730\u9009\u62E9\u6700\u4F73\u7684\u65B9\u5F0F\u6765\u5B9E\u73B0\u7F51\u7EDC\u7684\u5B9E\u65F6\u901A\u4FE1\u3002</p><h3 id="\u5BA2\u6237\u7AEF\uFF08vue-vue-socket-io\uFF09" tabindex="-1">\u5BA2\u6237\u7AEF\uFF08<a href="http://vue+vue-socket.io" target="_blank" rel="noopener noreferrer">vue+vue-socket.io</a>\uFF09 <a class="header-anchor" href="#\u5BA2\u6237\u7AEF\uFF08vue-vue-socket-io\uFF09" aria-hidden="true">#</a></h3><h4 id="\u5B89\u88C5" tabindex="-1">\u5B89\u88C5 <a class="header-anchor" href="#\u5B89\u88C5" aria-hidden="true">#</a></h4><div class="language-shell"><pre><code><span class="token function">npm</span> <span class="token function">install</span> vue-socket.io --save
</code></pre></div><h4 id="\u5B9E\u73B0" tabindex="-1">\u5B9E\u73B0 <a class="header-anchor" href="#\u5B9E\u73B0" aria-hidden="true">#</a></h4><ul><li>\u5F15\u5165 <a href="http://vue-socket.io" target="_blank" rel="noopener noreferrer">vue-socket.io</a></li></ul><div class="language-js"><pre><code><span class="token keyword">import</span> VueSocketIO <span class="token keyword">from</span> <span class="token string">&#39;vue-socket.io&#39;</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">VueSocketIO</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">connection</span><span class="token operator">:</span> <span class="token string">&#39;\u4F60\u7684\u5730\u5740&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">vuex</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>\u76D1\u542C\u670D\u52A1\u7AEF\u81EA\u5B9A\u4E49\u4E8B\u4EF6</li></ul><div class="language-js"><pre><code> <span class="token literal-property property">sockets</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u670D\u52A1\u5668\u4E8B\u4EF6\u540D\u5B57</span>
    <span class="token function-variable function">msg</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// \u4E3E\u4E2A\u4F8B\u5B50 \u670D\u52A1\u5668\u4F20\u6765 msg\u6D88\u606F</span>
    <span class="token function-variable function">online</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>\u6CE8\u610F\uFF1Asockets \u4E0E methods \u540C\u7EA7 \u4E0D\u5728 methods \u5185</p><h4 id="\u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898\u94FE\u63A5\u8BF7\u6C42\u8DE8\u57DF\u95EE\u9898" tabindex="-1">\u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898\u94FE\u63A5\u8BF7\u6C42\u8DE8\u57DF\u95EE\u9898 <a class="header-anchor" href="#\u53EF\u80FD\u9047\u5230\u7684\u95EE\u9898\u94FE\u63A5\u8BF7\u6C42\u8DE8\u57DF\u95EE\u9898" aria-hidden="true">#</a></h4><ul><li>\u5728 vue.config.js \u914D\u7F6E\u4E00\u4E0B\u4EE3\u7406</li></ul><div class="language-js"><pre><code> <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;/socket.io&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:9000&#39;</span><span class="token punctuation">,</span>
     <span class="token literal-property property">ws</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
     <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">&#39;/sockjs-node&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:9000&#39;</span><span class="token punctuation">,</span>
     <span class="token literal-property property">ws</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
     <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="node-\u670D\u52A1\u7AEF\uFF08express-socket-io\uFF09" tabindex="-1">node \u670D\u52A1\u7AEF\uFF08<a href="http://express+socket.io" target="_blank" rel="noopener noreferrer">express+socket.io</a>\uFF09 <a class="header-anchor" href="#node-\u670D\u52A1\u7AEF\uFF08express-socket-io\uFF09" aria-hidden="true">#</a></h3><h4 id="\u5B89\u88C5-1" tabindex="-1">\u5B89\u88C5 <a class="header-anchor" href="#\u5B89\u88C5-1" aria-hidden="true">#</a></h4><div class="language-shell"><pre><code><span class="token function">npm</span> <span class="token function">install</span> socket.io --save
</code></pre></div><h4 id="\u5B9E\u73B0-1" tabindex="-1">\u5B9E\u73B0 <a class="header-anchor" href="#\u5B9E\u73B0-1" aria-hidden="true">#</a></h4><div class="language-js"><pre><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;socket.io&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">allowEIO3</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">cors</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u89E3\u51B3\u8DE8\u57DF\u95EE\u9898</span>
app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Origin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&#39;Access-Control-Allow-Methods&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;GET,HEAD,OPTIONS,POST,PUT&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span>
    <span class="token string">&#39;Access-Control-Allow-Headers&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Origin, X-Requested-With, Content-Type, Accept, Authorization&#39;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> userOnline <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connection&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;login&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>client<span class="token punctuation">.</span>id <span class="token keyword">in</span> userOnline<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;\u4F60\u5DF2\u7ECF\u6765\u8FC7\u4E86&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> socket<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> data<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
        <span class="token literal-property property">socket</span><span class="token operator">:</span> socket<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      userOnline<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> socket<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> data<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;online&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> userOnline <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> data<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;submitmsg&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;disconnect&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> userOnline<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>id <span class="token operator">===</span> userOnline<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userOnline<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> user<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>id <span class="token operator">===</span> user<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&#39;\u8D70\u4E86&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>\u81F3\u6B64\u4FBF\u5B9E\u73B0\u4E86 socket \u7684\u7B80\u5355\u901A\u8BAF</li></ul><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/049cf13f737b46b586120eaa68eb0a17~tplv-k3u1fbpfcp-watermark.image" alt=""></p>`,22),e=[o];function c(u,l,i,k,r,d){return a(),s("div",null,e)}var g=n(p,[["render",c]]);export{f as __pageData,g as default};
